<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.css.network/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






  

<link href="//cdn.staticfile.org/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="blog of faywong, android, lisp, clojure" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="blog of faywong, faywong, 王飞">
<meta property="og:type" content="website">
<meta property="og:title" content="blog of faywong">
<meta property="og:url" content="http://faywong.github.io/page/4/index.html">
<meta property="og:site_name" content="blog of faywong">
<meta property="og:description" content="blog of faywong, faywong, 王飞">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="blog of faywong">
<meta name="twitter:description" content="blog of faywong, faywong, 王飞">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://faywong.github.io/page/4/"/>

  <title> blog of faywong </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">blog of faywong</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">love coding, love life</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/19/2016-01-25-first/" itemprop="url">
                  android开发中ConditionVariable的典型用法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-19T11:05:25+08:00" content="2016-07-19">
              2016-07-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/19/2016-01-25-first/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/19/2016-01-25-first/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>尽管现在诞生的高级语言里边有了什么STM，协程，绿程的概念，但写代码总会遇到现实（商业级平台都不会用很新的东西）的多线程的问题。</p>
<p>比如有时候你需要同步的获取在另一个线程执行的代码的结果，在android里这种场景下ConditionVariable就非常好用了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">if</span> (Looper.myLooper() != Looper.getMainLooper()) &#123;</div><div class="line"></div><div class="line">    <span class="keyword">final</span> ConditionVariable completed = <span class="keyword">new</span> ConditionVariable(); <span class="comment">// 构造一个条件变量</span></div><div class="line"></div><div class="line">    view.runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                doSomeThingInUiThread(); <span class="comment">// 将期望在另外线程做的事post出去</span></div><div class="line">            &#125; <span class="keyword">finally</span> &#123; <span class="comment">// finally很重要，防止运行时异常远跳转将ConditionVariable忘了open</span></div><div class="line">                completed.open(); <span class="comment">// 事情办完了，notify到另外线程</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    completed.block(TIMEOUT_WAIT_UI); <span class="comment">// 等着另外线程做的事完成，同时支持设置超时</span></div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    doSomeThingInUiThread();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当然了以上是很简单的一个场景，使用ConditionVariable非常方便且够用。对于复杂的多线程之间的协同还是使用标准的条件变量结合lock + while 循环检查。</p>
<p>在一些新语言中有非常丰富的并发编程原语（future, delay, promise），特别是协程让我们用代码自主的确定代码流之间的协作关系而不是被动的作为OS调度器的奴隶，来支撑一些并行需求。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/19/2016-04-19-first/" itemprop="url">
                  针对View LayoutParams做动画
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-19T11:05:25+08:00" content="2016-07-19">
              2016-07-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/19/2016-04-19-first/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/19/2016-04-19-first/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>mView是我们期望有动画效果的目标View</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">FrameLayout.LayoutParams mParams = ... <span class="comment">// 我们的目标 layout params</span></div><div class="line"><span class="keyword">if</span> (mTransitionTime &gt; <span class="number">0</span>) &#123;</div><div class="line">    ValueAnimator widthAnim = ValueAnimator.ofInt(<span class="number">0</span>, mParams.width); <span class="comment">// 从0变化到期望的宽度</span></div><div class="line">    widthAnim.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator valueAnimator)</span> </span>&#123;</div><div class="line">            <span class="comment">// 在回调里我们踩着节拍来修改 view 的 layout params</span></div><div class="line">            <span class="keyword">int</span> val = (Integer) valueAnimator.getAnimatedValue();</div><div class="line">            mParams.width = val;</div><div class="line">            <span class="keyword">if</span> (mView != <span class="keyword">null</span>) &#123;</div><div class="line">                mView.setLayoutParams(mParams);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    widthAnim.setDuration(mTransitionTime);</div><div class="line">    widthAnim.start();</div><div class="line"></div><div class="line">    ValueAnimator heightAnim = ValueAnimator.ofInt(<span class="number">0</span>, mParams.height); <span class="comment">// 从0变化到期望的高度</span></div><div class="line">    heightAnim.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator valueAnimator)</span> </span>&#123;</div><div class="line">            <span class="comment">// 在回调里我们踩着节拍来修改 view 的 layout params</span></div><div class="line">            <span class="keyword">int</span> val = (Integer) valueAnimator.getAnimatedValue();</div><div class="line">            mParams.height = val;</div><div class="line">            <span class="keyword">if</span> (mView != <span class="keyword">null</span>) &#123;</div><div class="line">                mView.setLayoutParams(mParams);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    heightAnim.setDuration(mTransitionTime);</div><div class="line">    heightAnim.start();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (mTransformDegree &gt; <span class="number">0</span>) &#123; <span class="comment">// 如果需要，在由小变大的过程中添加旋转效果</span></div><div class="line">    ObjectAnimator.ofFloat(mView, <span class="string">"rotation"</span>, <span class="number">0f</span>, mTransformDegree * <span class="number">1.0f</span>)</div><div class="line">            .setDuration(mTransitionTime &gt; <span class="number">0</span> ? mTransitionTime : <span class="number">0</span>).start();</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/19/2015-01-15-first/" itemprop="url">
                  WebView中支持input type="file"元素
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-19T11:05:25+08:00" content="2016-07-19">
              2016-07-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/19/2015-01-15-first/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/19/2015-01-15-first/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>方法如下：</p>
<p>在自定义的WebChromeClient中实现如下方法（主要是为了保证不同android版本上的兼容性）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openFileChooser</span><span class="params">(<span class="keyword">final</span> ValueCallback&lt;Uri&gt; uploadMsg)</span></span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openFileChooser</span><span class="params">(ValueCallback uploadMsg, String acceptType)</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openFileChooser</span><span class="params">(ValueCallback&lt;Uri&gt; uploadMsg, String acceptType, String capture)</span></div></pre></td></tr></table></figure>
<p>并配置proguard保证其不被混淆掉。</p>
<p>在openFileChooser中使用如下Intent调用系统文件浏览器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> Intent <span class="title">createDefaultOpenableIntent</span><span class="params">(<span class="keyword">final</span> Context ctx)</span> </span>&#123;</div><div class="line"><span class="comment">// Create and return a chooser with the default OPENABLE</span></div><div class="line"><span class="comment">// actions including the camera, camcorder and sound</span></div><div class="line"><span class="comment">// recorder where available.</span></div><div class="line">Intent i = <span class="keyword">new</span> Intent(Intent.ACTION_GET_CONTENT);</div><div class="line">i.addCategory(Intent.CATEGORY_OPENABLE);</div><div class="line">i.setType(<span class="string">"*/*"</span>);</div><div class="line"></div><div class="line">Intent chooser = createChooserIntent(ctx, createCameraIntent(), createCamcorderIntent(),</div><div class="line">createSoundRecorderIntent());</div><div class="line">chooser.putExtra(Intent.EXTRA_INTENT, i);</div><div class="line"><span class="keyword">return</span> chooser;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"></div><div class="line">startActivityForResult()</div></pre></td></tr></table></figure>
<p>在主Activity的onActivityResult()中</p>
<p>调用ValueCallback<uri>对象的onReceiveValue()方法中将选择文件的Uri传回。</uri></p>
<p>但是问题还是来了，这样做了之后在4.4系统上WebView不会回调openFileChooser方法导致没法显示出选择文件的Activity。</p>
<p>另外对于选择文件的应用也不能假定所有的Android系统上都有。</p>
<p>所以终极解决方案就是拥有自主可控的WebView。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/19/2015-11-26-first/" itemprop="url">
                  浅谈NavigationBar高度的获取
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-19T11:05:25+08:00" content="2016-07-19">
              2016-07-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/19/2015-11-26-first/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/19/2015-11-26-first/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>由于MEIZU手机的特殊性，对于NavigationBar的获取有特殊的讲究，有三个方面的因素：</p>
<p>1）MEIZU早期的系统（flyme os 5以下）存在smartbar，且可以设置智能隐藏；flyme os 5及以后smartbar被废弃，而使用android的NavigationBar</p>
<p>2）flymeos 5以下的系统有些存在系统dimen资源用于获取smartbar高度，有些则不再存在</p>
<p>3）是否智能隐藏SmartBar的开关并不与Android是否显示NavigationBar的开关为同一个</p>
<p>所以我今天研究了下，封装了一个方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getNavigationBarHeight</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> isMeiZu = Build.MANUFACTURER.equals(<span class="string">"Meizu"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> autoHideSmartBar = Settings.System.getInt(context.getContentResolver(),</div><div class="line">            <span class="string">"mz_smartbar_auto_hide"</span>, <span class="number">0</span>) == <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (isMeiZu) &#123;</div><div class="line">        <span class="keyword">if</span> (autoHideSmartBar) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                Class c = Class.forName(<span class="string">"com.android.internal.R$dimen"</span>);</div><div class="line">                Object obj = c.newInstance();</div><div class="line">                Field field = c.getField(<span class="string">"mz_action_button_min_height"</span>);</div><div class="line">                <span class="keyword">int</span> height = Integer.parseInt(field.get(obj).toString());</div><div class="line">                <span class="keyword">return</span> context.getResources().getDimensionPixelSize(height);</div><div class="line">            &#125; <span class="keyword">catch</span> (Throwable e) &#123; <span class="comment">// 不自动隐藏smartbar同时又没有smartbar高度字段供访问，取系统navigationbar的高度</span></div><div class="line">                <span class="keyword">return</span> getNormalNavigationBarHeight(context);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> getNormalNavigationBarHeight(context);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getNormalNavigationBarHeight</span><span class="params">(<span class="keyword">final</span> Context ctx)</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">final</span> Resources res = ctx.getResources();</div><div class="line">        <span class="keyword">int</span> rid = res.getIdentifier(<span class="string">"config_showNavigationBar"</span>, <span class="string">"bool"</span>, <span class="string">"android"</span>);</div><div class="line">        <span class="keyword">if</span> (rid &gt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">boolean</span> flag = res.getBoolean(rid);</div><div class="line">            <span class="keyword">if</span> (flag) &#123;</div><div class="line">                <span class="keyword">int</span> resourceId = res.getIdentifier(<span class="string">"navigation_bar_height"</span>, <span class="string">"dimen"</span>, <span class="string">"android"</span>);</div><div class="line">                <span class="keyword">if</span> (resourceId &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">return</span> res.getDimensionPixelSize(resourceId);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</div><div class="line">        LogCatLog.d(<span class="string">"FBTools"</span>, <span class="string">"getNormalNavigationBarHeight() exception:"</span> + e.getMessage());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/19/2015-01-16-first/" itemprop="url">
                  WebView getUserAgentString的副作用分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-19T11:05:25+08:00" content="2016-07-19">
              2016-07-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/19/2015-01-16-first/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/19/2015-01-16-first/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>源代码如下(以android 4.0.4为例)：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> String <span class="title">getUserAgentString</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (DESKTOP_USERAGENT.equals(mUserAgent) ||</div><div class="line">        IPHONE_USERAGENT.equals(mUserAgent) ||</div><div class="line">        !mUseDefaultUserAgent) &#123;</div><div class="line">        <span class="keyword">return</span> mUserAgent;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">boolean</span> doPostSync = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">synchronized</span>(sLockForLocaleSettings) &#123;</div><div class="line">        Locale currentLocale = Locale.getDefault();</div><div class="line">        <span class="keyword">if</span> (!sLocale.equals(currentLocale)) &#123;</div><div class="line">            sLocale = currentLocale;</div><div class="line">            mUserAgent = getCurrentUserAgent();</div><div class="line">            mAcceptLanguage = getCurrentAcceptLanguage();</div><div class="line">            doPostSync = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (doPostSync) &#123;</div><div class="line">        postSync();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> mUserAgent;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中后半段代码用于将当前locale设定同步到生成的UA中。所以该方法是有副作用的。</p>
<p>在一个使用了WebView的Activity里实例化完成和系统Configuration改变后都需要调用一次getUserAgentString()来让WebView的UA（前提是不要设置自己的UA，即没有针对此WebView调用过setUserAgentString）中locale分量与系统的设定保持一致。以免在访问多语言网站时出现适配问题。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/19/2016-03-20-first/" itemprop="url">
                  为 Duktape 添加 JavaScript 模块化加载能力
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-19T11:05:25+08:00" content="2016-07-19">
              2016-07-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/19/2016-03-20-first/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/19/2016-03-20-first/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://duktape.org/" target="_blank" rel="external">Duktape</a> 是一个体积小巧、可移植性高、适合嵌入到各种环境中的 JavaScript 引擎。</p>
<p>最近需要将 <a href="https://github.com/dcodeIO/protobuf.js" target="_blank" rel="external">protobuf.js</a> 移植到 Duktape 里边运行起来，所以需要解决 JavaScript 模块化加载问题，也就是要支持 require, module.exports 语法。我们通过 modSearch 函数来实现模块化加载：</p>
<h4 id="实现-modSearch-函数"><a href="#实现-modSearch-函数" class="headerlink" title="实现 modSearch 函数"></a>实现 modSearch 函数</h4><p><a href="http://wiki.duktape.org/HowtoModules.html" target="_blank" rel="external">Implementing a native modSearch() function</a>这篇 guide 里边有说通过在 native 实现 modSearch 函数就可以在 JavaScript 里通过require的时候加载到别的模块。</p>
<p>我在 c 层实现 modSearch 函数如下:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  main.c</span></div><div class="line"><span class="comment">//  duktape</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  Created by faywong on 16/3/18.</span></div><div class="line"><span class="comment">//  Copyright © 2016年 faywong. All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"duktape.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"fileio.h"</span></span></div><div class="line"></div><div class="line"><span class="keyword">duk_ret_t</span> my_mod_search(duk_context *ctx) &#123;</div><div class="line">    <span class="comment">/*</span></div><div class="line">     *   index 0: id (string)</div><div class="line">     *   index 1: require (object)</div><div class="line">     *   index 2: exports (object)</div><div class="line">     *   index 3: module (object)</div><div class="line">     */</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"fun: %s in, id: %s\n"</span>, <span class="number">__F</span>UNCTION__, duk_require_string(ctx, <span class="number">0</span>));</div><div class="line"></div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *id = duk_require_string(ctx, <span class="number">0</span>);</div><div class="line">    duk_pop_n(ctx, duk_get_top(ctx));</div><div class="line"></div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> FILE_PATH_LEN = <span class="number">1024</span>;</div><div class="line">    <span class="keyword">char</span> file[FILE_PATH_LEN];</div><div class="line">    <span class="built_in">memset</span>(file, <span class="number">0</span>, FILE_PATH_LEN);</div><div class="line">    <span class="built_in">snprintf</span>(file, FILE_PATH_LEN, <span class="string">"/Users/faywong/%s.js"</span>, id);</div><div class="line"></div><div class="line">    duk_push_string_file(ctx, file);</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Register Duktape.modSearch</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">register_mod_search</span><span class="params">(duk_context *ctx)</span> </span>&#123;</div><div class="line">    duk_eval_string(ctx, <span class="string">"(function (fun) &#123; Duktape.modSearch = fun; &#125;)"</span>);</div><div class="line">    duk_push_c_function(ctx, my_mod_search, <span class="number">4</span> <span class="comment">/*nargs*/</span>);</div><div class="line">    duk_call(ctx, <span class="number">1</span>);</div><div class="line">    duk_pop(ctx);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</div><div class="line"></div><div class="line">    duk_context *ctx = duk_create_heap_default();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (ctx) &#123;</div><div class="line"></div><div class="line">        register_mod_search(ctx);</div><div class="line"></div><div class="line">        register_fileio(ctx);</div><div class="line"></div><div class="line">        duk_eval_file(ctx, <span class="string">"/Users/faywong/test.js"</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"result is: %s\n"</span>, duk_safe_to_string(ctx, <span class="number">-1</span>));</div><div class="line">        duk_pop(ctx);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>test.js 用以验证实现的模块化加载功能是否正常，内容如下：<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> ByteBuffer = <span class="built_in">require</span>(<span class="string">'bytebuffer'</span>);</div><div class="line"><span class="keyword">var</span> test = <span class="keyword">new</span> ByteBuffer(<span class="number">10</span>);</div><div class="line">print(<span class="string">'step 1, ByteBuffer ok: '</span> + test.toString());</div><div class="line"><span class="keyword">var</span> ProtoBuf = <span class="built_in">require</span>(<span class="string">'protobuf'</span>);</div><div class="line">print(<span class="string">'step 2, ProtoBuf ok: '</span> + (<span class="keyword">typeof</span> ProtoBuf));</div><div class="line">print(<span class="string">'step 3, typeof ProtoBuf.loadProtoFile: '</span> + (<span class="keyword">typeof</span> ProtoBuf.loadProtoFile));</div><div class="line"><span class="keyword">var</span> builder = ProtoBuf.loadProtoFile(<span class="string">'/Users/faywong/complex.proto'</span>);</div><div class="line">print(<span class="string">'step 4, typeof builder: '</span> + (<span class="keyword">typeof</span> builder));</div><div class="line"></div><div class="line">Game = builder.build(<span class="string">"Game"</span>),</div><div class="line">Car = Game.Cars.Car;</div><div class="line"></div><div class="line"><span class="comment">// OR: Construct with values from an object, implicit message creation (address) and enum values as strings:</span></div><div class="line"><span class="keyword">var</span> car = <span class="keyword">new</span> Car(&#123;</div><div class="line">    <span class="string">"model"</span>: <span class="string">"Rustywq"</span>,</div><div class="line">    <span class="string">"vendor"</span>: &#123;</div><div class="line">        <span class="string">"name"</span>: <span class="string">"Iron Inc."</span>,</div><div class="line">        <span class="string">"address"</span>: &#123;</div><div class="line">            <span class="string">"country"</span>: <span class="string">"US"</span></div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="string">"speed"</span>: <span class="string">"SUPERFAST"</span> <span class="comment">// also equivalent to "speed": 2</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// OR: It's also possible to mix all of this!</span></div><div class="line"></div><div class="line"><span class="comment">// Afterwards, just encode your message:</span></div><div class="line"><span class="keyword">var</span> buffer = car.encode();</div><div class="line"></div><div class="line">print(<span class="string">'step 5, typeof buffer: '</span> + (<span class="keyword">typeof</span> buffer) + <span class="string">' toString(): '</span> + buffer.toString());</div></pre></td></tr></table></figure></p>
<p>其中：</p>
<ul>
<li><p><strong>register_mod_search</strong> 函数用于向 Duktape 注册一个用于加载 JavaScript 模块的函数 <strong>my_mod_search</strong>，该函数有四个入参，分别为模块 id、发起 require 的模块、本模块的 exports 对象、本模块的 module 对象，该函数加载 /Users/faywong 目录下以 id 为主文件名（比如在 test.js 中 require 到的 bytebuffer, protobuf）的 JavaScript 文件并将文件内容返回给 Duktape</p>
</li>
<li><p>为了方便，test.js 中 require 的其他 JavaScript 模块被笔者放在了自己的家目录下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">/Users/faywong/bytebuffer.js</div><div class="line">/Users/faywong/protobuf.js</div><div class="line">/Users/faywong/test.js</div></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/19/2015-01-15-fourth/" itemprop="url">
                  Android L上webview crash的问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-19T11:05:25+08:00" content="2016-07-19">
              2016-07-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/19/2015-01-15-fourth/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/19/2015-01-15-fourth/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在android L上测试反馈使用WebApp时会出现如下crash：<br><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">F/libc    ( 7555): Fatal signal 6 (SIGABRT) <span class="keyword">in</span> tid 12577 (RenderThread)</div><div class="line"></div><div class="line">I/DEBUG   (  182): *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***</div><div class="line"></div><div class="line">I/DEBUG   (  182): Build fingerprint: <span class="string">'google/hammerhead/hammerhead:L/LPV79/1236599:user/release-keys'</span></div><div class="line"></div><div class="line">I/DEBUG   (  182): Revision: <span class="string">'11'</span></div><div class="line"></div><div class="line">I/DEBUG   (  182): pid: 7555, tid: 12577, name: RenderThread  &gt;&gt;&gt; com.eg.android.AlipayGphone &lt;&lt;&lt;</div><div class="line"></div><div class="line">I/DEBUG   (  182): signal 6 (SIGABRT), code 0 (SI_USER), fault addr --------</div></pre></td></tr></table></figure></p>
<p>后来研究发现：</p>
<p><a href="https://code.google.com/p/android-developer-preview/issues/detail?can=2&amp;start=0&amp;num=100&amp;q=&amp;colspec=ID%20Type%20Status%20Owner%20Summary&amp;groupby=&amp;sort=&amp;id=950" target="_blank" rel="external">https://code.google.com/p/android-developer-preview/issues/detail?can=2&amp;start=0&amp;num=100&amp;q=&amp;colspec=ID%20Type%20Status%20Owner%20Summary&amp;groupby=&amp;sort=&amp;id=950</a></p>
<p>上有人报告同一问题。</p>
<p>LPV79这个build为developer preview version.存在一些问题。</p>
<p>后来在正式版本中验证同一问题，不可复现。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/19/2015-01-19-first/" itemprop="url">
                  android4.1上WebView页面加载成功时出现IllegalArgumentException
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-19T11:05:25+08:00" content="2016-07-19">
              2016-07-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/19/2015-01-19-first/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/19/2015-01-19-first/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>异常的堆栈如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">java.lang.IllegalArgumentException: bad parameter</div><div class="line">   at org.apache.http.client.utils.URLEncodedUtils.parse(URLEncodedUtils.java:<span class="number">139</span>)</div><div class="line">   at org.apache.http.client.utils.URLEncodedUtils.parse(URLEncodedUtils.java:<span class="number">76</span>)</div><div class="line">   at android.webkit.AccessibilityInjector.getAxsUrlParameterValue(AccessibilityInjector.java:<span class="number">412</span>)</div><div class="line">   at android.webkit.AccessibilityInjector.shouldInjectJavaScript(AccessibilityInjector.java:<span class="number">327</span>)</div><div class="line">   at android.webkit.AccessibilityInjector.onPageFinished(AccessibilityInjector.java:<span class="number">286</span>)</div><div class="line">   at android.webkit.WebViewClassic.onPageFinished(WebViewClassic.java:<span class="number">4088</span>)</div><div class="line">   at android.webkit.CallbackProxy.handleMessage(CallbackProxy.java:<span class="number">332</span>)</div><div class="line">   at android.os.Handler.dispatchMessage(Handler.java:<span class="number">99</span>)</div><div class="line">   at android.os.Looper.loop(Looper.java:<span class="number">137</span>)</div><div class="line">   at android.app.ActivityThread.main(ActivityThread.java:<span class="number">4829</span>)</div><div class="line">   at java.lang.reflect.Method.invokeNative(Native Method)</div><div class="line">   at java.lang.reflect.Method.invoke(Method.java:<span class="number">511</span>)</div><div class="line">   at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:<span class="number">841</span>)</div><div class="line">   at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:<span class="number">608</span>)</div><div class="line">   at dalvik.system.NativeStart.main(Native Method)</div></pre></td></tr></table></figure>
<p>相关的google code android project里边的issue中论述如下：</p>
<p>“<br>A customer of mine running 4.1.2 just informed me that the issue is still<br>present! After this issue crashes my app, I have to pop up a dialog<br>telling them to disable all accessibility services.<br>Worst user experience ever, but what else can I do.<br>……<br>Fixed in an internal build, to be released in the next major release.<br>……<br>The bug doesn’t occur here in 4.2.1 (Galaxy Nexus, JOP40D).<br>“</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/19/2016-04-01-first/" itemprop="url">
                  RN 对 模块尺寸的处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-19T11:05:25+08:00" content="2016-07-19">
              2016-07-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/19/2016-04-01-first/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/19/2016-04-01-first/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>由于容纳 RN view 的外围控件不确定，同时又要与其他view协调好尺寸和布局。<br>所以 RN 对 RootView（包含了一个模块的所有布局）的处理挺有技巧，RN 中有如下调用逻辑:</p>
<p>ReactActivity.createRootView -&gt; setContentView(mReactRootView)</p>
<p>ReactRootView.onMeasure()</p>
<p>ReactInstanceManagerImpl.attachMeasuredRootViewToInstance</p>
<p>UIManagerModule.addMeasuredRootView </p>
<p>得到宽高：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">final</span> <span class="keyword">int</span> width;</div><div class="line"><span class="keyword">final</span> <span class="keyword">int</span> height;</div><div class="line"><span class="comment">// If LayoutParams sets size explicitly, we can use that. Otherwise get the size from the view.</span></div><div class="line"><span class="keyword">if</span> (rootView.getLayoutParams() != <span class="keyword">null</span> &amp;&amp;</div><div class="line">    rootView.getLayoutParams().width &gt; <span class="number">0</span> &amp;&amp;</div><div class="line">    rootView.getLayoutParams().height &gt; <span class="number">0</span>) &#123;</div><div class="line">    width = rootView.getLayoutParams().width;</div><div class="line">    height = rootView.getLayoutParams().height;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    width = rootView.getWidth();</div><div class="line">    height = rootView.getHeight();</div><div class="line">&#125;   </div><div class="line"></div><div class="line">rootView.setOnSizeChangedListener(</div><div class="line"><span class="keyword">new</span> SizeMonitoringFrameLayout.OnSizeChangedListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSizeChanged</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> width, <span class="keyword">final</span> <span class="keyword">int</span> height, <span class="keyword">int</span> oldW, <span class="keyword">int</span> oldH)</span> </span>&#123;</div><div class="line">    getReactApplicationContext().runOnNativeModulesQueueThread(</div><div class="line">        <span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            updateRootNodeSize(tag, width, height);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>通过这个 SizeMonitoringFrameLayout.OnSizeChangedListener 将 SizeMonitoringFrameLayout（实际扮演一个容器 ViewGroup 来监听布局的改变）的宽高传递给 css-layout 用于布局各个”盒”节点。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/19/2017-05-9-first/" itemprop="url">
                  android 代码风格指南
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-19T11:05:25+08:00" content="2016-07-19">
              2016-07-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/19/2017-05-9-first/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/19/2017-05-9-first/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h3><p>本文档简述了推荐的 android 平台开发代码风格指南</p>
<h3 id="源代码文件"><a href="#源代码文件" class="headerlink" title="源代码文件"></a>源代码文件</h3><h4 id="文件命名"><a href="#文件命名" class="headerlink" title="文件命名"></a>文件命名</h4><p>以本文件中最顶级class名加上.java后缀命名，且大小写敏感</p>
<h4 id="文件编码"><a href="#文件编码" class="headerlink" title="文件编码"></a>文件编码</h4><p>UTF-8</p>
<h4 id="特殊字符"><a href="#特殊字符" class="headerlink" title="特殊字符"></a>特殊字符</h4><h4 id="空白字符"><a href="#空白字符" class="headerlink" title="空白字符"></a>空白字符</h4><p>只允许ascii水平空白符(0x20)</p>
<h4 id="文件组织"><a href="#文件组织" class="headerlink" title="文件组织"></a>文件组织</h4><p>一般，一份源代码文件按照如下结构组织：</p>
<ul>
<li>授权、版权信息，如果有</li>
<li>包声明</li>
<li>导入声明</li>
<li>只包含一个顶级类</li>
</ul>
<p>并以一个空白行分隔以上每部分</p>
<ol>
<li><p>包声明<br>包声明不要进行行截断(见段4.5)，每行最多100列的限制不会施加于包声明</p>
</li>
<li><p>导入声明<br> 导入声明不要进行行截断（见段4.5），每行最多100列的限制不会施加于导入声明<br> 导入声明按以下规则分组：</p>
<p> 所有static导入为一组</p>
<p> 第三方的，按照顶级包的字母序排列，例如：android, com, junit, org, sun<br> java， javax打头的</p>
<p> 组内按照字母序排序<br> 不要使用通配符式导入，而是使用完全限定名称的类<br> 推荐：<code>import foo.Bar;</code>（优点是显式指定了特定的类）<br> 不推荐：<code>import foo.*;</code>（优点是少写import声明，但是可读性差，且给维护者带来了代价）</p>
</li>
<li><p>类声明</p>
<ul>
<li>每源代码有且仅有一个顶级类</li>
<li>成员函数的排列顺序  <br><br>一般应该按照逻辑集中的规则来排列（例如操作同一数据的方法尽量放在一起），而不要是新近添加的方法总是放在最后</li>
<li>重载的多个函数应该连续排列</li>
</ul>
</li>
</ol>
<p>###格式###<br>术语：块级结构指：类、方法、构造方法体（若数组以语句块的形式初始化，也视为块级结构）</p>
<ol>
<li><p>花括号  <br><br> 花括号应该与if, else, for, do, while语句一起使用，即便其内容为空或只包含单行语句</p>
</li>
<li><p>非空语句块采用K&amp;R风格  <br><br>  对于非空语句块，花括号遵循K&amp;R风格<br></p>
<ul>
<li>左括号前不换行</li>
<li>左括号后换行</li>
<li>右括号前换行</li>
<li>如果右括号结束一个语句块或者函数体、构造函数体或者有命名的类体，则需要换行。但当右括号后面接else或者逗号时，不应该换行, 例如：</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">return</span> <span class="keyword">new</span> MyClass() &#123;</div><div class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (condition()) &#123;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        something();</div><div class="line">      &#125; <span class="keyword">catch</span> (ProblemException e) &#123;</div><div class="line">        recover();</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ol>
<li>空白块级结构使用场景  <br><br>方法体为空，或空的构造方法(一个空的语句块，可以在左花括号之后直接接右花括号，中间不需要空格或换行，使代码更简洁),例如：</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">doNothing</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmptyConstruct</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EmptyConstruct</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li><p>块级缩进  <br><br>4个空白字符（同时适用于代码和注释）</p>
</li>
<li><p>一条语句占一行</p>
</li>
<li><p>列数限制  <br><br>超出100列长度的行应该进行断行（见下一段）  <br><br>例外：  <br></p>
<ul>
<li>没法遵循以上限制，比如JavaDoc中很长的URL，或一个很长的<a href="http://www.gwtproject.org/doc/latest/DevGuideCodingBasicsJSNI.html" target="_blank" rel="external">JSNI</a>方法引用</li>
<li>包声明，导入声明</li>
<li>可以被直接拷贝粘贴到shell中的命令</li>
</ul>
</li>
<li><p>断行  <br><br>术语说明：当一行代码按照其他规范都合法，只是为了避免超出行长度限制而换行时，称为长行断行</p>
<ul>
<li>在何处进行断行  <br><br> 一个原则：尽可能选择在更高的句法级别上进断行，且：<pre><code>1. 若遇到非赋值操作符，则在该符号前截断。这条规则同样适用于点操作符的.，类型组合符（&lt;T extends Foo &amp; Bar&gt;），catch块中的管道线（catch (FooException | BarException e)）
2. 若遇到赋值操作符，则在该符号后截断。这条规则同样适用于类赋值操作符（foreach 语句中的:），例如：
</code></pre></li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">IAccessibilityServiceConnection connection =</div><div class="line">    AccessibilityInteractionClient.getInstance().getConnection(mConnectionId);</div><div class="line">IAccessibilityServiceConnection connection = AccessibilityInteractionClient</div><div class="line">        .getInstance().getConnection(mConnectionId);</div></pre></td></tr></table></figure>
<pre><code>    3. 方法名或构造方法名与跟随其后的开括号保持连续
    4. `,`紧跟它之前的符号

* 缩进后续行最低4个空白字符（建议8个空白字符）  &lt;br /&gt;
    截断后的后续行（即不包含第一行）相对原始行最低缩进4个（建议8个）空白字符，多个后续行的情形下，若他们属于同一层的句法元素，则应保持相同的缩进级别

* 空白字符
   1. 垂直空白
      单行空行在以下情况使用：
</code></pre><p>a、类成员间需要空行隔开：例如成员变量、构造函数、成员函数、内部类、静态初始化语句块（static initializers）、实例初始化语句块（instance initializers）。<strong>例外：成员变量之间的空白行不是必需的。</strong> 一般多个成员变量中间的空行，是为了对成员变量做逻辑上的分组。</p>
<p>b、在函数内部，根据代码逻辑分组的需要，设置空白行作为间隔。</p>
<p>c、类的第一个成员之前，或者最后一个成员结束之后，用空行间隔。（可选）</p>
<p>d、本文档中其他部分介绍的需要空行的情况。（例如 3.3节中的import语句）<br>单空行时使用多行空行是允许的，但是不要求也不鼓励。</p>
<pre><code>2. 水平空白
除了语法、其他规则、词语分隔、注释和javadoc外，水平的ASCII空格只在以下情况出现：
</code></pre><p>a、所有保留的关键字与紧接它之后的位于同一行的左括号之间需要用空格隔开。（例如if、for、catch）</p>
<p>b、所有保留的关键字与在它之前的右花括号之间需要空格隔开。（例如else、catch）</p>
<p>c、在左花括号之前都需要空格隔开。只有两种例外：<br>    @SomeAnnotation({a, b})<br>  String[][] x = foo;</p>
<p>d、所有的二元运算符和三元运算符的两边，都需要空格隔开。<br>e、逗号、冒号、分号和右括号之后，需要空格隔开。</p>
<p>f、// 双斜线开始一行注释时。双斜线两边都应该用空格隔开。并且可使用多个空格，但是不做强制要求。</p>
<p>g、变量声明时，变量类型和变量名之间需要用空格隔开。</p>
<p>h、初始化一个数组时，花括号之间可以用空格隔开，也可以不使用。（例如：new int[] {5, 6} 和 new int[] { 5, 6 } 都可以）</p>
<p>注意：这一原则不影响一行开始或者结束时的空格。只针对行内部字符之间的隔开。</p>
<ol>
<li>特殊结构<ol>
<li>修饰符<pre><code>若存在，类和方法的修饰符应该按照以下顺序排列：
</code></pre><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">protected</span> <span class="keyword">private</span> <span class="keyword">abstract</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="keyword">synchronized</span> <span class="keyword">native</span> <span class="keyword">strictfp</span></div></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<h3 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h3><ol>
<li><p>类名<br>大写打头的驼峰风格</p>
</li>
<li><p>方法名<br>小写打头的驼峰风格<br>最好以动词，或动宾短语命名  <br><br>唯一建议使用下划线的地方是在JUnit中用于为多个测试方法进行逻辑分组，一个典型的模式：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">test&lt;MethodUnderTest&gt;_&lt;state&gt;</div><div class="line">testPop_emptyStack <span class="comment">// example</span></div></pre></td></tr></table></figure>
<p>缩略词当做单词对待，而不要保持全大写（比如推荐命名为getUrl, 而不是getURL）</p>
</li>
<li><p>常量名<br>所有字母大写，单词之间以下划线分割<br>例如：</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Constants</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NUMBER = <span class="number">5</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> ImmutableList&lt;String&gt; NAMES = ImmutableList.of(<span class="string">"Ed"</span>, <span class="string">"Ann"</span>);</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> Joiner COMMA_JOINER = Joiner.on(<span class="string">','</span>);  <span class="comment">// because Joiner is immutable</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> SomeMutableType[] EMPTY_ARRAY = &#123;&#125;;</div><div class="line"><span class="keyword">enum</span> SomeEnum &#123; ENUM_CONSTANT &#125;</div><div class="line"><span class="comment">// Not constants</span></div><div class="line"><span class="keyword">static</span> String nonFinal = <span class="string">"non-final"</span>;</div><div class="line"><span class="keyword">final</span> String nonStatic = <span class="string">"non-static"</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> Set&lt;String&gt; mutableCollection = <span class="keyword">new</span> HashSet&lt;String&gt;();</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> ImmutableSet&lt;SomeMutableType&gt; mutableElements = ImmutableSet.of(mutable);</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> Logger logger = Logger.getLogger(MyClass.getName());</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> String[] nonEmptyArray = &#123;<span class="string">"these"</span>, <span class="string">"can"</span>, <span class="string">"change"</span>&#125;;</div></pre></td></tr></table></figure>
<ol>
<li>驼峰规则<br> 如何将英文词汇转换为符合驼峰规则的标识符<table border="2"><br><tbody><br><tr><br><td>语义</td><br><td>推荐</td><br><td>不建议</td><br></tr><br><tr><br><td>“XML HTTP request”</td><br><td>XmlHttpRequest</td><br><td>XMLHTTPRequest</td><br></tr><br><tr><br><td>“new customer ID”</td><br><td>newCustomerId</td><br><td>newCustomerID</td><br></tr><br><tr><br><td>“inner stopwatch”</td><br><td>innerStopwatch</td><br><td>innerStopWatch</td><br></tr><br><tr><br><td>“supports IPv6 on iOS?”</td><br><td>supportsIpv6OnIos</td><br><td>supportsIPv6OnIOS</td><br></tr><br><tr><br><td>“YouTube importer”</td><br><td>YouTubeImporter</td><br><td>YoutubeImporter</td><br></tr><br></tbody><br></table>

</li>
</ol>
<p>可接受但不推荐的情形:  <br><br>  “nonempty”和”non-empty”都是合法的英文单词, 所以checkNonempty和checkNonEmpty都可以认为正确</p>
<p>注意：请命名时一定准备一本英文词典在附近，不要出现基本的英文拼写错误，目前已经发现的案例有：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">behaviour/behavor, pool/poll, request/reqeust, <span class="keyword">continue</span>, external, prerference</div></pre></td></tr></table></figure>
<h3 id="编程实践"><a href="#编程实践" class="headerlink" title="编程实践"></a>编程实践</h3><p>尽量使用@Override(不管是扩展重写方法还是实现接口)来避免直到运行时才可以发现的错误<br><br><br>例如以下打字错误只有在运行时才能发现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">oncreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>而采用以下写法错误在编译时就能被发现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">oncreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>不要完全忽略异常，尽管这非常诱人</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">  <span class="keyword">int</span> i = Integer.parseInt(response);</div><div class="line">  <span class="keyword">return</span> handleNumericResponse(i);</div><div class="line">&#125; <span class="keyword">catch</span> (NumberFormatException ok) &#123;</div><div class="line">  <span class="comment">// it's not numeric; that's fine, just continue</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> handleTextResponse(response);</div></pre></td></tr></table></figure>
<p>绝对不要这么做。也许你会认为：<br>你的代码永远不会碰到这种出错的情况，或者处理异常并不重要，<br>可类似上述忽略异常的代码将会在代码中埋下一颗地雷，说不定哪天它就会炸到某个人了。<br>你必须在代码中以某种规矩来处理所有的异常。根据情况的不同，处理的方式也会不一样。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">无论何时，空的catch语句都会让人感到不寒而栗。</div><div class="line">然很多情况下确实是一切正常，但至少你不得不去忧虑它。在Java中你无法逃离这种恐惧感。&quot;</div><div class="line">                                -James Gosling</div></pre></td></tr></table></figure>
<p>可接受的替代方案包括（按照推荐顺序）:</p>
<p>1) 向方法的调用者抛出异常</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">setServerPort</span><span class="params">(String value)</span> <span class="keyword">throws</span> NumberFormatException </span>&#123;</div><div class="line">    serverPort = Integer.parseInt(value);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2) 根据抽象级别抛出新的异常<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">setServerPort</span><span class="params">(String value)</span> <span class="keyword">throws</span> ConfigurationException </span>&#123;</div><div class="line">   <span class="keyword">try</span> &#123;</div><div class="line">       serverPort = Integer.parseInt(value);</div><div class="line">   &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</div><div class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> ConfigurationException(<span class="string">"Port "</span> + value + <span class="string">" is not valid."</span>);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>3) 默默地处理错误并在catch {}语句块中替换为合适的值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">setServerPort</span><span class="params">(String value)</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        serverPort = Integer.parseInt(value);</div><div class="line">    &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</div><div class="line">        serverPort = <span class="number">80</span>;  <span class="comment">// default port for server</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>4) 捕获异常并抛出一个新的RuntimeException。这种做法比较危险：只有确信发生该错误时最合适的做法就是崩溃，才会这么做<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">setServerPort</span><span class="params">(String value)</span> </span>&#123;</div><div class="line">   <span class="keyword">try</span> &#123;</div><div class="line">       serverPort = Integer.parseInt(value);</div><div class="line">   &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</div><div class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"port "</span> + value <span class="string">" is invalid, "</span>, e);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>5) 如果确信忽略异常比较合适，那就忽略吧，但必须把合理的原因注释出来<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">setServerPort</span><span class="params">(String value)</span> </span>&#123;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">          serverPort = Integer.parseInt(value);</div><div class="line">      &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</div><div class="line">          <span class="comment">// Method is documented to just ignore invalid user input.</span></div><div class="line">          <span class="comment">// serverPort will just be unchanged.</span></div><div class="line">      &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>例外：在测试用例中一个期望发生的异常<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    emptyStack.pop();</div><div class="line">    fail();</div><div class="line">&#125; <span class="keyword">catch</span> (NoSuchElementException expected) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>尽量不要因为想偷懒而要捕获顶级的Exception<br><br><br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    someComplicatedIOFunction();        <span class="comment">// may throw IOException</span></div><div class="line">    someComplicatedParsingFunction();   <span class="comment">// may throw ParsingException</span></div><div class="line">    someComplicatedSecurityFunction();  <span class="comment">// may throw SecurityException</span></div><div class="line">                                        <span class="comment">// phew, made it all the way</span></div><div class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;                 <span class="comment">// I'll just catch all exceptions</span></div><div class="line">    handleError();                      <span class="comment">// with one generic handler!</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>不要这么做。绝大部分情况下，捕获顶级的Exception或Throwable都是不合适的，Throwable更不合适，因为它还包含了Error异常。这种捕获非常危险。<br><br>这意味着本来不必考虑的Exception（包括类似ClassCastException的RuntimeException）被卷入到应用程序级的错误处理中来。<br><br>这会让代码运行的错误变得模糊不清。这意味着，假如别人在你调用的代码中加入了新的异常，编译器将无法帮助你识别出各种不同的错误类型。<br><br>绝大部分情况下，无论如何你都不应该用同一种方式来处理各种不同类型的异常。<br></p>
<p>当你执意想这样做：<br><br>在开始之前，你应该非常仔细地考虑一下，并在注释中解释清楚为什么这么做是安全的<br></p>
<p>比捕获顶级Exception更好的方案：<br></p>
<p>分开捕获每一种异常，在一条try语句后面跟随多个catch语句块。<br><br>这样可能会有点别扭，但总比捕获所有Exception要好些。请小心别在catch语句块中重复执行大量的代码。</p>
<p>重新组织一下代码，使用多个try块，使错误处理的粒度更细一些。把IO从解析内容的代码中分离出来，根据各自的情况进行单独的错误处理。<br></p>
<p>再次抛出异常。很多时候在你这个级别根本就没必要捕获这个异常，只要让方法抛出该异常即可。<br></p>
<p>请建立一个观点：异常是你的朋友！当编译器指出你没有捕获某个异常时，请不要皱眉头。而应该微笑：编译器帮助你找到了代码中的运行时（runtime）问题。<br></p>
<p>静态成员：通过类名来限定</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">Foo aFoo = ...;</div><div class="line">Foo.aStaticMethod(); <span class="comment">// good</span></div><div class="line">aFoo.aStaticMethod(); <span class="comment">// bad</span></div></pre></td></tr></table></figure>
<p>永远不要重载finalize方法，除非：<br><br><br>你需要在JNI方法中在Java对象被GC回收时释放native层资源</p>
<p>尽量限制变量的作用域</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// GOOD</span></div><div class="line"><span class="keyword">if</span> (…) &#123;</div><div class="line">    <span class="keyword">double</span> d = someCalculation(…);</div><div class="line">    doSomethingWith(d);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">// No use of d</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// BAD</span></div><div class="line"><span class="keyword">double</span> d = <span class="number">0</span>;</div><div class="line"><span class="keyword">if</span> (…) &#123; … &#125; <span class="keyword">else</span> &#123; … &#125;</div></pre></td></tr></table></figure>
<p>为临时性/不完美代码使用TODO注释<br><br><br>TODO注释的格式为：<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// <span class="doctag">TODO:</span> &#123;your_comments_here&#125;</span></div></pre></td></tr></table></figure></p>
<p>类和方法前的概述段一般是名词或动词短语，而不要是一整句话，比如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// BAD</span></div><div class="line">A &#123;<span class="meta">@code</span> Foo&#125; is a...</div><div class="line"><span class="comment">// BAD too</span></div><div class="line">This method returns...</div></pre></td></tr></table></figure>
<p>也不要是一个祈使句：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Save the record..</div></pre></td></tr></table></figure></p>
<p>然而需要注意的是：概述段需要想完整的一句话一样打头字母大写，添加合适的标点等等</p>
<p>正确的注释，例如android AOSP项目中类<em>MediaCodecInfo</em>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Provides information about a given media codec available on the device. You can</div><div class="line"> * iterate through all codecs available by querying &#123;<span class="doctag">@link</span> MediaCodecList&#125;...</div><div class="line"> */</div><div class="line"> <span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MediaCodecInfo</span> </span>&#123;</div><div class="line"> ......</div></pre></td></tr></table></figure>
<p>每个类和自建的public方法必须包含Javadoc注释<br><br><br>注释至少要包含描述该类或方法用途的语句。并且该语句应该用第三人称的动词形式来开头</p>
<p>组织方法的原则</p>
<ul>
<li>简短(对方法的代码长度并没有硬性的限制，但通常如果方法代码超过了40行，就该考虑是否可以在不损害程序结构的前提下进行分拆)</li>
<li>专注于完成单一功能</li>
<li>可重用</li>
<li>易于测试</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpeg"
               alt="faywong" />
          <p class="site-author-name" itemprop="name">faywong</p>
          <p class="site-description motion-element" itemprop="description">blog of faywong, faywong, 王飞</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">42</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">faywong</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="http://cdn.css.net/libs/jquery/1.8.0/jquery-1.8.0.min.js"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"faywong"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  
<script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js">
</script>


</body>
</html>
